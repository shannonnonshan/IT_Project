
{{#section "css"}}
    <link href="/static/css/album.css" rel="stylesheet">
{{/section}}
<div class="album-content" id="album-song-content">
    <table class="song-table">
        <thead>
            <tr>
                <th>#</th>
                <th>Title</th>
                <th>Artist</th>
                <th>Date Added</th>
                <th><i class="fas fa-clock"></i></th>
            </tr>
        </thead>
        <tbody id="song-list">
            {{#each listSong}}
            <tr class="song-row" data-song-index="{{@index}}" data-song-name="{{SongName}}" data-artist-name="{{artistName}}"
                data-album-name="{{AlbumName}}" data-song-url="/static/songs/{{SongID}}/main.mp3"
                data-cover-url="/static/imgs/song/{{SongID}}/main.jpg">
                <td>{{displayIndex}}</td>
                <td>
                    <div class="album-row">
                        <img src="/static/imgs/song/{{SongID}}/main.jpg" alt="{{SongName}} Cover" class="playlist-cover">
                        <p class="album-title">{{SongName}}</p>
                    </div>
                </td>
                <td>{{artistName}}</td>
                <td>{{DateAdded}}</td>
                <td>{{duration}}</td>
            </tr>
            {{/each}}
        </tbody>
    </table>
</div>
{{#section "script"}}
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Lấy tất cả các hàng bài hát
            const songRows = document.querySelectorAll('.song-row');
            const playPauseButton = document.getElementById('playPauseButton');
            const playPauseIcon = document.getElementById('playPauseIcon');
            songRows.forEach(row => {
                row.addEventListener('click', () => {
                    // Lấy metadata từ data-* attributes
                    const songIndex = parseInt(row.getAttribute('data-song-index'), 10);
                    const songName = row.getAttribute('data-song-name');
                    const artistName = row.getAttribute('data-artist-name');
                    const albumName = row.getAttribute('data-album-name');
                    const songUrl = row.getAttribute('data-song-url');
                    const coverUrl = row.getAttribute('data-cover-url');

                    // Metadata mới
                    const newMetaData = {
                        name: songName,
                        artist: artistName,
                        album: albumName,
                        url: songUrl,
                        cover_art_url: coverUrl,
                    };

                    // Cập nhật metadata cho bài hát
                    Amplitude.setSongMetaData(songIndex, newMetaData);

                    // Phát bài hát ngay
                    
                    Amplitude.playSongAtIndex(songIndex);

                    // Tuỳ chọn: Highlight bài hát đang phát
                    songRows.forEach(r => r.classList.remove('active'));
                    row.classList.add('active');
                });
            });
        });
    </script>
{{/section}}
