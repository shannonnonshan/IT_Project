
{{#section "css"}}
    <link href="/static/css/output.css" rel="stylesheet">
{{/section}}

<div class="flex fex-row justify-content-center gap-3 pt-2 h-auto">
  <div class="w-[63%]
  bg-[linear-gradient(180deg,_#37266A_18%,_#5150B1_47%,_#3A397E_76%)] 
  rounded-[20px] flex flex-col ">
  <div class="w-full px-1.5 mt-5">
  <div class="flex flex-row mt-[3%] px-5">
      {{!-- phần 1 --}}
      <div class=" min-w-[200px] min-h-[200px] max-w-[200px] max-h-[200px]">
        {{!-- ảnh ava --}}
        <img src="/static/imgs/avatar.jpg" alt=""  class='rounded-full object-cover'>
      </div>
      <div class="flex flex-col justify-center ml-5">
        {{!-- tên, lượng follower --}}
        <span class="block text-[36px] text-white font-bold font-spartan">
            Hồ sơ
        </span>
        <span class="block text-[80px] leading-none text-white font-bold font-spartan drop-shadow-lg custom-stroke">
            {{#if this.user.name}}
            {{this.user.name}}
            {{else}}
                Log In, first!!!
            {{/if}}
        </span>
        <div>
        <span class="block text-[18px] text-white  font-normal font-spartan">
            {{this.user.PublicPlaylist}} danh sách phát công khai
        </span>
        <span class="block text-[18px] text-white  font-normal font-spartan">
            {{this.user.NoOfFollower}} người theo dõi
        </span>
        <span class="block text-[18px] text-white  font-normal font-spartan">
            {{this.user.NoOfFollowing}} đang theo dõi
        </span>
        </div>
      </div>
  </div>
  <div class="flex flex-col mt-3">
      <div class="flex flex-row gap-10 px-5">  
          <div>
            <span class="block text-[20px] text-white  font-bold font-spartan">
            Nghệ sỹ hàng đầu tháng này
            </span>
            <span class="block text-[16px] text-white font-normal font-spartan">
            Chỉ hiển thị mình bạn
            </span>
          </div>
          <div>
            <button type="button" onclick="window.location.href='/account/upload'" class="btn btn-sm rounded-[20px] py-2 px-5 btn btn-light font-bold font-spartan">
              <i class="bi bi-upload"></i>
              Tải nhạc lên
            </button>
          </div>
      </div>
      <div id="artists-container" class="flex flex-row overflow-x-auto mt-8 max-w-[100%]"
      style=" -ms-overflow-style: none; scrollbar-width: none; ">
          {{#each this.artists}}
                <div class="w-[200px] h-[220px] mr-2 bg-black/25 rounded-[30px] flex flex-col items-start p-4">
                  <img class="w-[100px] h-[100px] rounded-full self-center mb-2" src="/static/imgs/artist/{{ArtistID}}/main.jpg" />
                  <div class="w-[168px] text-white text-xl font-bold font-spartan mt-3 truncate">{{ArtistName}}</div>
                  <div class="w-[262.56px] text-stone-400 text-[15px] font-normal font-spartan">Nghệ sỹ</div>
                </div>
          {{/each}}
          <a id="load-more" data-offset="5" class="btn btn-sm btn-outline-light flex flex-col justify-center rounded-[30px] font-spartan">
            <i class="bi bi-plus-square-dotted">
                Xem thêm
            </i>
          </a>
      </div>
  </div>
  <div class="flex flex-col mt-3">
      <div class="px-5">  
          <div>
            <span class="block text-[20px] text-white  font-bold font-spartan">
            Album hàng đầu tháng này
            </span>
            <span class="block text-[16px] text-white font-normal font-spartan">
            Chỉ hiển thị mình bạn
            </span>
          </div>
      </div>
      <div id="albums-container" class="flex flex-row overflow-x-auto max-w-[100%] mt-8"
      style=" -ms-overflow-style: none; scrollbar-width: none; ">
          {{#each this.albums}}
                <div class="w-[200px] h-[220px] mr-2 bg-black/25 rounded-[30px] flex flex-col items-start p-4">
                  <img class="w-[100px] h-[100px] rounded-full self-center mb-2" src="/static/imgs/album/{{AlbumID}}/main.jpg" />
                  <div class="w-[168px] text-white text-xl font-bold font-spartan mt-3 truncate">{{AlbumName}}</div>
                  <div class="w-[262.56px] text-stone-400 text-[15px] font-normal font-spartan">Album</div>
                </div>
          {{/each}}
          <a href="#" id="load-more-album" class="btn btn-sm btn-outline-light flex flex-col justify-center rounded-[30px] font-spartan">
            <i class="bi bi-plus-square-dotted">
                Xem thêm
            </i>
          </a>
      </div>
  </div>
  <div class="flex flex-col mt-3">
      <div class="px-5">  
          <div>
            <span class="block text-[20px] text-white  font-bold font-spartan">
            Bài hát được bạn đăng tải
            </span>
          </div>
      </div>
      <div id="albums-container" class="flex flex-row overflow-x-auto max-w-[100%] mt-8 mb-20"
      style=" -ms-overflow-style: none; scrollbar-width: none; ">
      {{#if this.userSong.length}}
          {{#each this.userSong}}
                <div class="w-[200px] h-[220px] mr-2 bg-black/25 rounded-[30px] flex flex-col items-start p-4">
                  <img class="w-[100px] h-[100px] rounded-full self-center mb-2" src="/static/imgs/song/{{SongID}}/main.jpg" />
                  <div class="w-[168px] text-white text-xl font-bold font-spartan mt-2 truncate">{{SongName}}</div>
                  <span class="block w-[262.56px] text-stone-400 text-[15px] font-normal font-spartan">Ngày đăng:</span>
                  <span class="block w-[262.56px] text-stone-400 text-[15px] font-normal font-spartan">{{formatDate CreatedDate}}</span>
                </div>
          {{/each}}
        {{else}}
          <div class="w-full text-center text-stone-400 text-[15px] h-[200px] font-normal font-spartan mt-4">
            Chưa có bài hát nào được upload bởi bạn
          </div>
        {{/if}}
          {{!-- <a href="#" id="load-more-album" class="btn btn-sm btn-outline-light flex flex-col justify-center rounded-[30px] font-spartan">
            <i class="bi bi-plus-square-dotted">
                Xem thêm
            </i>
          </a> --}}
      </div>  
  </div>
  </div>
  </div>
  <div class="w-[30%]  bg-black rounded-[20px] mx-3 px-1" >
    <div class="w-full px-2 mt-3" style=" -ms-overflow-style: none; scrollbar-width: none;">
    <div id="carouselExampleControlsNoTouching" class="carousel slide mx-auto mt-2 w-[95%] min-h-[700px]" data-bs-touch="false">
    <div class="carousel-inner">
      <div class="carousel-item active rounded-[20px] bg-violet-300 p-2 mx-auto h-full">
         <span class="block text-[23px] text-black font-bold font-spartan mx-8 mt-5 pb-5">
            Top Nghệ Sỹ Của Tôi
          </span>
          {{#each this.artists}}
          <div class="flex flex-row  mx-3 mt-3 items-center">
            <span class=" text-[40px] text-black font-bold font-spartan w-8 h-8 mr-3">{{ArtistID}}</span>
            <img src="/static/imgs/artist/{{ArtistID}}/main.jpg" alt="artist" class="w-[80px] h-[80px] mr-2">
            <span class=" text-[20px] text-black font-bold font-spartan">{{ArtistName}}</span>
          </div>
          {{/each}}
        </div>
      <div class="carousel-item rounded-[20px] bg-white p-2 h-[650px]">
        <span class="block text-[23px] text-black font-bold font-spartan mx-8 mt-5 pb-5">
          Top Bài hát của tôi
        </span>
        {{#each this.artists}}
        <div class="flex flex-row mx-3 mt-3 items-center">
          <span class=" text-[40px] text-black font-bold font-spartan w-8 h-8 mr-3">{{ArtistID}}</span>
          <img src="{{ArtistPic}}" alt="artist" class="w-[80px] h-[80px] mr-2">
          <span class=" text-[20px] text-black font-bold font-spartan">{{ArtistName}}</span>
        </div>
        {{/each}}
      </div>
      <div class="carousel-item  rounded-[20px] bg-[#FF5B47] p-2 h-[650px]">
        <span class="block text-[23px] text-center text-black font-bold font-spartan mx-8 mt-5 pb-5">
          Số phút bạn đã nghe
        </span>
        <div class="flex flex-col mx-3 mt-3 items-center">
          <span class=" text-[80px] text-black font-bold font-spartan">10,000</span>
          <span class=" text-[16px] text-black font-bold font-spartan mt-2">Nằm trong 39% người nghe</span>
          <span class=" text-[16px] text-black font-bold font-spartan">Tôi nghe nhiều hơn tháng trước 129 phút</span>
        </div>
        
      </div>
      </div>   
      <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControlsNoTouching" data-bs-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      </button>
      <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControlsNoTouching" data-bs-slide="next">
        <span class="carousel-control-next-icon " aria-hidden="true"></span>
      </button>
    </div>
    </div>
  </div>
</div>

{{#section 'script'}}
<script>
  let currentOffset = 5;
document.addEventListener("DOMContentLoaded", function() {
  
  document.getElementById('load-more').addEventListener('click', function () {
    const button = this;
    const limit = 5; // Mỗi lần load thêm 5 bản ghi

 fetch(`/account/artist?offset=${currentOffset}&limit=${limit}`)
    .then(response => {
      if (!response.ok) {
        console.error('Response not OK:', response.status);
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      return response.json();
    })
    .then(data => {
      const container = document.getElementById('artists-container');
      data.artists.forEach(artist => {
        const artistDiv = document.createElement('div');
        artistDiv.className = 'w-[200px] h-[220px] mr-2 bg-black/25 rounded-[30px] flex flex-col items-start p-4';
        artistDiv.innerHTML = `
          <img class="w-[100px] h-[100px] rounded-full self-center mb-2" src="/static/imgs/artist/${artist.ArtistID}/main.jpg" alt="${artist.ArtistName}" />
          <div class="w-[168px] text-white text-xl font-bold font-spartan mt-3">${artist.ArtistName}</div>
          <div class="w-[262.56px] text-stone-400 text-[15px] font-normal font-spartan">Nghệ sỹ</div>
        `;
        container.prepend(artistDiv); // Thêm artist mới vào đầu danh sách
      });

      currentOffset += limit;

      if (!data.hasMore) {
        button.style.display = 'none';
      }
    })
    .catch(error => console.error('Error loading more artists:', error));
  });
});
</script>

<script>
  let currentOffset2 = 5;
  document.addEventListener("DOMContentLoaded", function() {
    document.getElementById('load-more-album').addEventListener('click', function () {
      const button2 = this;
      const limit2 = 5; // Mỗi lần load thêm 5 bản ghi

      fetch(`/account/album?offset=${currentOffset2}&limit=${limit2}`)
        .then(response => {
          if (!response.ok) {
            console.error('Response not OK:', response.status);
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          console.log('Data fetched:', data);

          if (!data.albums || !Array.isArray(data.albums)) {
            throw new Error('Invalid data format: `albums` is missing or not an array');
          }

          const container = document.getElementById('albums-container');
          data.albums.forEach(album => {
            const albumDiv = document.createElement('div');
            albumDiv.className = 'w-[200px] h-[220px] mr-2 bg-black/25 rounded-[30px] flex flex-col items-start p-4';
            albumDiv.innerHTML = `
              <img class="w-[100px] h-[100px] rounded-full self-center mb-2" src="/static/imgs/album/${album.AlbumID}/main.jpg" alt="${album.AlbumName}" />
              <div class="w-[168px] text-white text-xl font-bold font-spartan mt-3">${album.AlbumName}</div>
              <div class="w-[262.56px] text-stone-400 text-[15px] font-normal font-spartan">Nghệ sỹ</div>
            `;
            container.prepend(albumDiv);
          });

          currentOffset2 += limit2;

          if (!data.hasMore) {
            button2.style.display = 'none';
          }
        })
        .catch(error => console.error('Error loading more albums:', error));
    });
  });
</script>

{{/section}}